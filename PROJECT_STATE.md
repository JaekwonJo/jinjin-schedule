# 📊 PROJECT_STATE.md - 진진영어 시간표 현황

**마지막 업데이트**: 2025-10-02 03:45 (KST)

## 🎯 전체 진행률: 62%
- 관리자/선생님 흐름이 모두 연결되어, 수정 요청 → 승인 → 알림 확인까지 한 줄로 이어졌어요.
- 이제 notes 데이터 확장과 알림 고도화, 출력/보고 기능만 남아 있어요.

---

## ✅ 완료된 작업

### 2025-10-01
- [x] 루트/클라이언트 npm 스크립트 분리 (`npm run dev`, `npm run client:install` 등)
- [x] `client/` 전용 CRA 패키지 구성 (`package.json`, 실행 스크립트)
- [x] Express + SQLite 연결 및 기본 스키마(`templates`, `schedule_entries`, `change_requests`)
- [x] 템플릿/시간표/수정요청 API 라우트 초안 구현
- [x] `sqlite3` 네이티브 빌드 문제 해결 (`npm rebuild sqlite3 --build-from-source`)
- [x] CSV(9월29일) 구조 분석 및 임포트 전략 문서화 (`docs/data-import-plan.md`)
- [x] 로그인/권한 구조 기획 문서화 (`docs/auth/login-flow.md`)
- [x] React `TemplateContext`로 템플릿/시간표 상태 중앙 관리
- [x] 템플릿 선택·이름 수정 컴포넌트(`TemplateHeader`) 초안 + 시간표 UI 연동

### 2025-10-02
- [x] 사용자 계정 테이블(`users`) 및 슈퍼관리자 자동 시드 로직 추가
- [x] JWT 기반 로그인 API(`/api/auth/login`)와 미들웨어(authenticate/requireRole) 구현
- [x] 슈퍼관리자 계정 관리 API(`GET/POST/PATCH /api/users`) 구성
- [x] 템플릿/요청 API에 역할 기반 접근 제어 적용
- [x] 환경 변수 기본값 및 경고 추가 (`server/config.js`)
- [x] 로그인 페이지/UI 제작 및 감성 디자인 적용
- [x] 프론트 인증 컨텍스트(AuthProvider)와 토큰 보관 로직 구축
- [x] 템플릿 화면을 로그인 사용자에게만 노출 & 권한별 버튼 비활성화 처리
- [x] 선생님 자체 가입 API(`/api/auth/signup`)와 가입 폼 연결
- [x] superadmin 전용 계정 관리 패널(UI)에서 승인/역할/비활성/비번 초기화 처리
- [x] 수정 요청 로그 패널(UI)에서 승인/거절 흐름 구현
- [x] 시간표 셀 모달(EditCellModal)로 학생·메모를 한 번에 편집
- [x] 선생님 클릭 시 수정 요청 작성 → API 전송 흐름 연결
- [x] 승인/거절 알림을 토스트/배지로 노출하고 읽음 처리까지 제공
- [x] 인쇄용 미리보기(PDF 대비) 초안 및 학원 로고 적용
- [x] 선생님 전용 요청 히스토리 패널(검색/필터) 추가
- [x] 이메일 알림을 위한 SMTP 스텁 및 환경 변수 가이드 작성

---

## 🔄 진행 중인 작업
- [ ] notes 데이터를 기반으로 한 보고/출력(프린트, PDF) 구조 설계
- [ ] 승인/거절 알림을 이메일·문자 등 외부 알림으로 확장할 설계
- [ ] 수정 요청 로그 필터/검색 UX 고도화 및 히스토리 뷰 준비

---

## ⏳ 예정된 작업

### 1순위: 시간표 만들기·편집
- [ ] React 상태 관리 구조 정의 (템플릿/시간표/요청 분리)
- [ ] 시간표 API 연동 + 저장(덮어쓰기) 화면 구성
- [ ] 템플릿 생성/전환 UI + 기본 밸리데이션

### 2순위: 변경 이력 추적 & 승인
- [ ] 변경 이력 테이블 설계(`history_logs` 등) 및 API 추가
- [ ] 수정 요청 알림 로직 (pending → 이메일, 웹 알림)
- [ ] 관리자 승인 화면 UX 확정 및 라우팅

### 3순위 이후
- [ ] 학생 정보 관리 화면 (이름/학교/학년)
- [ ] 스마트 알림 (중복, 누락 감지)
- [ ] PDF/카카오톡 공유용 출력
- [ ] CSV/구글시트 일괄 임포트 스크립트 구현

---

## 🐛 알려진 이슈
- CRA 기반 `client/` 패키지에서 `npm audit` 고위험 경고가 발생 (React 19 + CRA 조합 이슈). 추후 Vite 전환 또는 CRA 업그레이드 시 해결 예정.
- 새 환경에서 `sqlite3` 사용 시 네이티브 바이너리를 한 번 빌드해야 함 (`npm rebuild sqlite3 --build-from-source`).

---

## ✅ 해결된 이슈
- *(신규)* WSL 환경에서 `sqlite3` 모듈 로드 실패 → 수동 리빌드로 해결.

---

## 📋 다음 단계 (Top 3)
1. notes 필드를 활용한 PDF/프린트용 레이아웃 초안 만들기.
2. 승인/거절 알림을 이메일·문자 등 외부 알림으로 확장할 준비하기.
3. 수정 요청 로그 필터/검색, 선생님별 히스토리 보기 기능 설계하기.

---

## 💡 기술적 결정 사항

| 항목 | 선택 | 이유 |
|------|------|------|
| Frontend | React 19 (CRA) | 기존 코드 재사용, 빠른 UI 프로토타입 |
| Backend | Node.js + Express 5 | 심플한 REST API 구성 |
| Database | SQLite | 파일 기반, 빠른 시작 |
| Drag & Drop | react-beautiful-dnd (예정) | 직관적 DnD 구현 |
| 이메일 | Nodemailer (예정) | 설정 간단, 무료 |

---

## 🎯 현재 우선순위
- **데이터 모델 정리 → UI 연동 → 승인 흐름** 순서로 베타 버전을 완성합니다.
- 목표: 며칠 안에 1순위 기능(시간표 편집) 베타 버전 완성!

---

*다음 업데이트는 UI와 API가 연결되는 즉시 공유할게요.*
