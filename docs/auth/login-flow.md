# 로그인 및 권한 계획 (계정 기반)

## 1. 계정 유형 & 권한

| 역할 코드 | 설명 | 로그인 자격 | 주요 권한 |
|-----------|------|-------------|-----------|
| `teacher` | 일반 선생님 | 관리자에게 계정을 발급받은 선생님 | 시간표 보기, 수정 요청 작성 |
| `manager` | 관리 선생님 | 승인/운영 담당 선생님 | 위 권한 + 수정 요청 승인/거절, 템플릿 수정 |
| `superadmin` | 최고 관리자 (JaekwonJo) | 프로젝트 최초 1명 | 모든 권한 + 계정 생성/비밀번호 초기화 |

- 모든 사용자는 **아이디(예: jungT)** + **비밀번호**로 로그인합니다.
- 비밀번호는 해시(bcrypt)로 암호화하여 `users` 테이블에 저장합니다.
- 최초 `superadmin` 계정은 `.env`에 지정한 시드 값으로 자동 생성한 뒤, 이후에는 UX로 관리합니다.

## 2. 인증·계정 관리 흐름

```
[로그인 폼]
  └─ (아이디/비밀번호 입력) → POST /api/auth/login
      └─ 서버에서 비밀번호 비교(bcrypt) & 계정 상태 확인
          ├─ 성공: JWT(24시간 유효) + 사용자 정보(role) 반환
          └─ 실패: 오류 메시지 (잘못된 정보, 계정 비활성 등)
```

1. 최고 관리자는 “계정 관리” 화면에서 아이디/비밀번호/역할을 지정해 새 계정을 만듭니다.
2. 관리자는 발급된 계정을 각 선생님께 전달합니다. (예: `hyunT / 초기비밀번호`)
3. 선생님은 로그인 후 시간표를 확인하고 필요한 수정 요청을 남깁니다.
4. 관리 선생님은 동일한 로그인 화면에서 들어와 요청을 승인/거절합니다.
5. 토큰 만료(24시간) 또는 로그아웃 시 다시 로그인해야 합니다.

추후 패치 계획: 사용자 본인이 비밀번호를 변경할 수 있는 페이지 제공.

## 3. 화면·기능 접근 매트릭스

| 기능/화면 | teacher | manager | superadmin |
|-----------|---------|---------|-------------|
| 시간표 보기 | ✅ | ✅ | ✅ |
| 수정 요청 작성 | ✅ | ✅ | ✅ |
| 수정 요청 승인/거절 | ❌ | ✅ | ✅ |
| 템플릿 생성·이름 수정 | ❌ | ✅ | ✅ |
| 계정 목록 보기 | ❌ | ❌ | ✅ |
| 계정 생성/비밀번호 초기화 | ❌ | ❌ | ✅ |
| 시스템 설정 (예: 이메일 발송 설정) | ❌ | ❌ | ✅ |

- 프론트: 라우터 가드 + 역할 기반 메뉴 노출 제어
- 백엔드: 미들웨어(`requireRole('manager')`, `requireRole('superadmin')`)로 이중 보호

## 4. 구현 체크리스트

### 백엔드
- [ ] `users` 테이블 생성 (id, username, display_name, role, password_hash, is_active, created_at, updated_at)
- [ ] 시드 스크립트: 존재하지 않으면 `.env` 기반 superadmin 자동 생성
- [ ] POST `/api/auth/login` (JWT 발급, 유효기간 24시간, refresh 없이 단순 만료)
- [ ] JWT 검증 미들웨어 + 역할 검사 미들웨어
- [ ] superadmin 전용 API
  - [ ] POST `/api/users` (새 계정 생성)
  - [ ] PATCH `/api/users/:id/password` (비밀번호 초기화)
  - [ ] GET `/api/users` (계정 목록)
  - [ ] PATCH `/api/users/:id/status` (활성/비활성)

### 프론트엔드
- [ ] 로그인 페이지 (`LoginPage`): 아이디 + 비밀번호 입력 폼
- [ ] 인증 컨텍스트 (`AuthProvider`) — 토큰, 사용자 정보, 자동 로그아웃 처리
- [ ] 보호 라우트 컴포넌트 (`RequireRole`)
- [ ] superadmin용 계정 관리 UI (간단한 테이블 + 생성/초기화 모달)
- [ ] 로그인 실패/세션 만료 UX (친절한 안내)

## 5. 추후 확장 아이디어
- 비밀번호 변경/분실 기능 (이메일 또는 관리자 승인)
- 활동 로그 저장 (언제 누가 로그인/승인했는지)
- 2단계 인증 또는 IP 제한 (필요 시)

---

*목표: 며칠 안에 핵심 기능(시간표 + 승인) 완성 후, 계정 관리는 superadmin이 손쉽게 할 수 있게!*
