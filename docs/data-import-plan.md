# CSV → DB 임포트 계획

## 1. 원본 CSV 구조 메모
- 파일: `/mnt/c/Users/jaekw/Downloads/시간표 - 시간표 9월 29일 이후(진행중).csv`
- 열 개수: 10개 (0~9 index)
  - `0`: 시간대 (`2:00`, `3:30`, ...). 이후 행에서 비어 있으면 직전 시간대 유지.
  - `1`: 담당 선생님 + 강의실 정보 (줄바꿈으로 분리됨). 예: `"정\n3-A"` → 선생님 `정`, 강의실 `3-A`.
  - `2~7`: 월~토 요일별 수업 내용. 줄바꿈 + 쉼표로 학생명이 섞여 있음.
  - `8, 9`: 추가 슬롯(같은 시간대에 병행되는 다른 반)으로 추정. `8`은 선생님, `9`는 해당 반 상세.
- 첫 번째 헤더 행: `['9월', '담당\n선생님', '29(월)', '30(화)', ...]`
  - 날짜/요일 문자열에서 요일을 추출해 DB의 `day_of_week` (0=월 ~ 6=일)로 매핑할 예정.

## 2. 파싱 로직 초안
1. `Papa.parse`(프론트) 또는 `csv-parse`(서버)로 CSV를 UTF-8로 읽어옵니다.
2. 첫 번째 행은 헤더로 저장 → 요일/날짜 매핑 테이블 구성.
3. 각 행을 순회하면서
   - `row[0]`이 비어 있지 않으면 `currentTime = row[0]` 업데이트.
   - `row[1]`을 `\n`으로 분리 → `[teacherName, classroom?]` 식으로 나눔.
   - 요일 열(`row[2]~row[7]`) 각각에 대해 내용이 있으면
     - 문자열을 `\n` 기준으로 먼저 split → 제목/학생목록 분리.
     - 학생 목록은 쉼표 기준으로 split + trim → 배열로 저장.
     - DB `schedule_entries`에 `{ template_id, day_of_week, time_label: currentTime, teacherName, classroom, studentNamesRaw, notes }` 형태로 생성.
   - `row[8]`, `row[9]`도 값이 있으면 별도 `extra` 슬록으로 동일한 방식으로 저장 (day_of_week는 우선 비워두고 `notes`에 저장) → 이후 실제 의미 파악 후 요일 할당.
4. 반복 중 비어 있는 줄은 건너뛰고, `currentTime`/`teacherName`/`classroom`을 유지합니다.

## 3. DB 저장 전략
- `template_id`는 임포트 대상 템플릿(예: "2024-09-29 정규")을 사전에 만들고 그 ID를 사용.
- 기존 `schedule_entries`는 임포트 전에 삭제한 뒤 전체를 새로 INSERT (트랜잭션 처리).
- 학생명은 우선 `student_names` TEXT 컬럼에 `','`로 join해서 저장.
  - 추후 학생 DB가 준비되면 이 데이터를 사용해 학생 테이블을 채우고 관계 테이블로 분리 예정.
- 교실/비고는 `notes`에 JSON 문자열(`{"classroom":"3-A","raw":...}`) 형태로 저장하면 확장성이 좋음.

## 4. 추가 확인 포인트
- 열 8,9의 정확한 의미: 두 번째 캠퍼스인지, 비고인지 → 원장님 확인 후 처리 분기.
- 일요일 데이터가 다른 시트에 있는지 확인 필요. (현재 CSV에는 토요일까지만 존재.)
- CSV 내 공백/테스트 학생(`(테스트요일)`) 문구 정리 방식 결정.

## 5. 예정 작업
1. 위 로직을 코드로 옮긴 `importCsv` 스크립트 작성 (`server/scripts/importCsv.js` 예상).
2. 템플릿 ID를 선택하거나 새로 만드는 CLI 옵션 제공.
3. 임포트 후 `schedule_entries` 정상 저장 확인용 간단한 리포트 출력.
4. 일괄 임포트 API/페이지는 1차 완성 이후(패치)로 미뤄도 OK.

*필요한 추가 정보(열 8,9 용도 등)는 원장님께 한 번에 여쭙고, 확보되는 즉시 문서 업데이트 예정입니다.*
